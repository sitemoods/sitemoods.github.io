<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>Moods - Fatura</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    
    <style type="text/css">

* {
  margin: 0;
  padding: 0;
  font-family: "Lucida Console", Monaco, monospace;
}



body {
  background: url("") center center no-repeat;
  background-size: cover;
  width: 100vw;
  height: 100vh;
  display: grid;
  align-items: center;
  justify-items: center;

}

.fatura {
  background: #f8f4e5;
  padding: 50px 100px;
  border: 2px solid black;
  box-shadow: 15px 15px 1px #ffa580, 15px 15px 1px 2px black;
}

input {
  display: block;
  width: 100%;
  font-size: 14pt;
  line-height: 28pt;
  margin-bottom: 28pt;
  border: none;
  border-bottom: 5px solid black;
  background: #f8f4e5;
  min-width: 250px;
  padding-left: 5px;
  outline: none;
  color: black;
}

input:focus {
  border-bottom: 5px solid #ffa580;
}

.desc {
	display: block;
  width: 100%;
  font-size: 14pt;
  line-height: 28pt;
  margin-bottom: 28pt;
  border: none;
  background: #f8f4e5;
  min-width: 250px;
  padding-left: 5px;
  outline: none;
  color: black;
}

button {
  display: block;
  margin: 0 auto;
  line-height: 28pt;
  padding: 0 20px;
  background: #ffa580;
  letter-spacing: 2px;
  transition: 0.2s all ease-in-out;
  outline: none;
  border: 1px solid black;
  box-shadow: 3px 3px 1px #95a4ff, 3px 3px 1px 1px black;
}
button:hover {
  background: black;
  color: white;
  border: 1px solid black;
}

::selection {
  background: #ffc8ff;
}

input:-webkit-autofill,
input:-webkit-autofill:hover,
input:-webkit-autofill:focus {
  border-bottom: 5px solid #95a4ff;
  -webkit-text-fill-color: #2A293E;
  -webkit-box-shadow: 0 0 0px 1000px #f8f4e5 inset;
  transition: background-color 5000s ease-in-out 0s;
}

.vl {
  border-left: 1px solid transparent;
  height: 30px;
}

.btns {
    display: block;
	float: left;
	padding: 20px;
}

.footer {
	display: block;
	font-size:0.5em;
}

.logo img{
	margin-bottom: 30px;
	display: block;
    margin-left: auto;
    margin-right: auto;
}
.info {
	padding: 10px;
}

    </style>
</head>
<body>

	<div class="fatura">
		<div class="logo">
		<a href="https://moods.com.br"><img src="https://moods.com.br/img/svg2/moods.svg" alt="MOODS"></a>
	</div>
	<div class="info">
	<span class="desc" id="servico">Carregando dados...</span>
	<span id="status" class="aviso">Em Aberto</span>
     </div>
		<form id="infoboleto">
		  <input id="cliente" placeholder="Cliente:" type="text" readonly/>
		  <input id="valor" placeholder="R$: " type="text" readonly/>
		  <input id="vencimento" placeholder="Vencimento: __/__/__" type="text" readonly/>
		  <input id="linhadigital" placeholder="Carregando dados..." type="text" readonly/>
		</form>
		<div id="agradecimento" style="display: none"><h4><span id="servico" class="">Obrigado!</span></h4></div>
		<div class="btns">
			<a  id="linkboleto" href="#" target="_blank"><button type="button">Boleto PDF</button></a>
		</div>
		<div class="btns">
		  <span id="btnnota" style="display: none"><a id="linknota" href="#" target="_blank"><button type="button">Nota Fiscal</button></a></span>
		</div>
	</div>
		<hr>
		<div class="footer">
			
		<p>Jardim Sonoro - Curitiba-PR, Brasil - CNPJ: 12.553.127/0001­17</p>
	</div>
	  
	  <div class="vl"></div>


<script type="text/javascript">

var linknota = "z"
var idboleto = "z"

function getUrlVars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
        vars[key] = value;
    });
    return vars;
}




function monthName(mon) {
   return ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'August', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'][mon - 1];
}



var xmlhttp = new XMLHttpRequest();
xmlhttp.onreadystatechange = function() {
  if (this.readyState == 4 && this.status == 200) {
    var myObj = JSON.parse(this.responseText);
    
    if (myObj.boleto.status == "paid") {
    Status = "Pago";
    document.getElementById("status").classList.add('green');
    document.getElementById("infoboleto").style.display = "none";
    document.getElementById("agradecimento").style.display = "block";
    }
    else {
    Status = "Aberta";
    document.getElementById("status").classList.add('yellow');
    };
    document.getElementById("status").innerHTML = Status;
    
    
    
    
    document.getElementById("linhadigital").value = myObj.boleto.barCode;
 
  
  valor = String(myObj.boleto.amount).slice(0,-2) + "," + String(myObj.boleto.amount).slice(-2);
  document.getElementById("valor").value = "Valor: R$ "+ valor;
  
  
  var dataiso = myObj.boleto.due; 
  var vencano = dataiso.slice(0,5);
  // var vencmes = dataiso.replace(vencano, "");
  //vencmes = vencmes.slice(0,2);
  vencmes = dataiso.slice(5,7);
  vencmes = vencmes.replace("-", "");
  vencmes = monthName(vencmes);
  var vencdia = dataiso.slice(8,10);
  
   document.getElementById("vencimento").value = "Vencimento: " + vencdia + " / " + vencmes;

	console.log("Tags:")
	console.log(myObj.boleto.tags[0])
  
  document.getElementById("cliente").value = "Cliente: " + myObj.boleto.name;
    document.getElementById("servico").innerHTML = myObj.boleto.descriptions[0] && myObj.boleto.descriptions[0].text;
    document.getElementById("linkboleto").href="https://api.starkbank.com/v1/charge/" + idboleto + "/pdf";
    if (typeof myObj.boleto.tags[0] !== 'undefined') {
		linknota=myObj.boleto.tags[0];
	}
	document.getElementById("linknota").href=linknota;

    if ( linknota.includes("http")) {
        document.getElementById("btnnota").style.display = "block";
    }
  } else if (this.readyState == 4 && this.status !== 200) {
	  document.body.style.display = "none"; 
	  window.alert(this.responseText);
  }
};

if (typeof getUrlVars()["id"] === 'undefined') {
	document.body.style.display = "none"; 
	window.alert("URL incompleta, sem ID da fatura.")
	} else {
		var idboleto = getUrlVars()["id"];
		xmlhttp.open("GET", "https://api.starkbank.com/v2/boleto/"+idboleto, true);
		xmlhttp.send();
	}


</script>
</body>
</html>

